<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Particle Effects</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --cream-parchment: #F7F3E9;
            --dusty-rose: #C08497;
            --rich-saffron: #E8A317;
        }

        body {
            background-color: var(--cream-parchment);
            min-height: 100vh;
            overflow: hidden;
        }

        #spice-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        .grain-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
            opacity: 0.08;
            background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwBAMAAAClLOS0AAAAElBMVEUAAAD8/vz08teleHrw8teleHoZ5X8LAAAAAXRSTlMAQObYZgAAAAlwSFlzAAAOxAAADsQBlSsOGwAAAb1JREFUOBGdU8uKwzAMzEMoNLQH04MpNJTQQ6CnQC+lp6a/t5O/K8nOtrQQ9mDJM6MZ25m8VkbNAQR4nAgPbMQQEf2PxEgaFc0xExGxYDCWtHOJqEoaqzBt7BOGDNmQ4gHI2YEgOqRxZxZc7DM0SYKJIISqh/p2AOJ2k9A8IAONOvKQz+Lw/4bQWJ/Fh8gQuIQAYknXlQSIxKV0BU5C4FQEChOViP5CqHVrQ5wE0OYj5F2G6bQeKn3DVQJ9ALgJCsI4OZkUAcTk/vD2AADGB8E18BL+D/RAbSyQqEfQvwjKd+4tO6qBp96GbLCJBYoFD7EUQMPe8B1Ur4qDXSjw1gj+JGhAAzFG0DMEKoRxF4F4CQFQ+sAaghMCeAaBPLMYJEL3DQMBNJGAqxgpxA9C8xzQAphxdBNjNoD6/kPQ3qpBv1MjgTPT8FxPZD7ADGjCg3KBMF2K7CbxXxGJH+B7wwT0DTxhP/RGbqP7DBuKKZRLN8bO+oj5l6F4Rj7NnGCpxgAAAABJRU5ErkJggg==");
            background-repeat: repeat;
            background-size: 64px 64px;
            animation: grainShift 0.5s steps(4) infinite;
        }

        @keyframes grainShift {
            0%, 100% { transform: translate(0, 0); }
            25% { transform: translate(-2px, 2px); }
            50% { transform: translate(2px, -2px); }
            75% { transform: translate(-2px, -2px); }
        }

        .muddy-flow {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
            background:
                linear-gradient(180deg,
                    rgba(139, 115, 85, 0.04) 0%,
                    rgba(139, 115, 85, 0.08) 50%,
                    rgba(139, 115, 85, 0.04) 100%);
            animation: muddyFlow 25s ease-in-out infinite;
        }

        @keyframes muddyFlow {
            0%, 100% { opacity: 0.7; }
            50% { opacity: 1; }
        }
    </style>
</head>
<body>
    <div class="muddy-flow"></div>
    <canvas id="spice-canvas"></canvas>
    <div class="grain-overlay"></div>

    <script>
        (function initSpiceDust() {
            const canvas = document.getElementById('spice-canvas');
            if (!canvas) return;

            const ctx = canvas.getContext('2d');
            let particles = [];
            const PARTICLE_COUNT = 200;

            const drinkSpiceColors = {
                'default': [
                    { r: 232, g: 163, b: 23 },
                    { r: 114, g: 47, b: 55 },
                    { r: 210, g: 105, b: 30 },
                    { r: 192, g: 132, b: 151 },
                    { r: 139, g: 115, b: 85 },
                    { r: 204, g: 85, b: 0 },
                ]
            };

            let currentColors = drinkSpiceColors['default'];

            let scrollY = 0;
            let targetScrollY = 0;
            const parallaxStrength = 0.15;

            let isTabActive = true;
            let lastFrameTime = 0;
            const activeFrameInterval = 1000 / 60;
            const inactiveFrameInterval = 1000 / 10;

            document.addEventListener('visibilitychange', () => {
                isTabActive = !document.hidden;
            });

            window.addEventListener('scroll', () => {
                targetScrollY = window.scrollY;
            }, { passive: true });

            function resize() {
                const oldWidth = canvas.width || window.innerWidth;
                const oldHeight = canvas.height || window.innerHeight;
                const newWidth = window.innerWidth;
                const newHeight = window.innerHeight;

                canvas.width = newWidth;
                canvas.height = newHeight;

                if (particles.length > 0 && oldWidth > 0 && oldHeight > 0) {
                    const scaleX = newWidth / oldWidth;
                    const scaleY = newHeight / oldHeight;

                    particles.forEach(p => {
                        p.x *= scaleX;
                        p.y *= scaleY;
                        p.x = Math.max(0, Math.min(p.x, newWidth));
                        p.y = Math.max(0, Math.min(p.y, newHeight));
                    });
                }
            }

            function createParticle() {
                const color = currentColors[Math.floor(Math.random() * currentColors.length)];
                const baseSize = Math.random() * 4 + 2;
                return {
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height,
                    size: baseSize,
                    speedX: (Math.random() - 0.5) * 0.3,
                    speedY: Math.random() * 0.2 + 0.05,
                    opacity: Math.random() * 0.25 + 0.08,
                    color: { ...color },
                    wobble: Math.random() * Math.PI * 2,
                    wobbleSpeed: Math.random() * 0.02 + 0.005
                };
            }

            function init() {
                resize();
                particles = [];
                for (let i = 0; i < PARTICLE_COUNT; i++) {
                    particles.push(createParticle());
                }
            }

            function animate(currentTime) {
                const frameInterval = isTabActive ? activeFrameInterval : inactiveFrameInterval;
                if (currentTime - lastFrameTime < frameInterval) {
                    requestAnimationFrame(animate);
                    return;
                }
                lastFrameTime = currentTime;

                ctx.clearRect(0, 0, canvas.width, canvas.height);

                scrollY += (targetScrollY - scrollY) * 0.1;

                particles.forEach(p => {
                    p.wobble += p.wobbleSpeed;

                    p.x += p.speedX + Math.sin(p.wobble) * 0.2;
                    p.y += p.speedY;

                    if (p.y > canvas.height + 10) {
                        p.y = -10;
                        p.x = Math.random() * canvas.width;
                    }
                    if (p.x > canvas.width + 10) p.x = -10;
                    if (p.x < -10) p.x = canvas.width + 10;

                    const depthFactor = (p.size / 6) * parallaxStrength;
                    const parallaxOffsetY = scrollY * depthFactor;

                    const colorStr = `rgba(${Math.round(p.color.r)}, ${Math.round(p.color.g)}, ${Math.round(p.color.b)}, ${p.opacity})`;
                    ctx.beginPath();
                    ctx.arc(p.x, p.y - parallaxOffsetY, p.size, 0, Math.PI * 2);
                    ctx.fillStyle = colorStr;
                    ctx.shadowColor = colorStr;
                    ctx.shadowBlur = p.size * 2;
                    ctx.fill();
                });

                ctx.shadowBlur = 0;

                requestAnimationFrame(animate);
            }

            window.addEventListener('resize', resize);

            init();
            animate();
        })();
    </script>
</body>
</html>
